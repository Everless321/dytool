# 任务: Swift 客户端集成 Python 后端 - 用户信息自动获取

## 日期
2026-01-22 23:32:10

## 任务描述
在 Swift 客户端中创建统一的 HTTP 请求类，并在用户输入 URL 后自动从 Python 后端获取用户信息。

## 待办事项
- [x] 创建 BackendService.swift 统一 HTTP 请求类
- [x] 更新 AddUserSheet 支持自动获取用户信息
- [x] 更新后端 users.py 正确处理 Cookie
- [x] Swift 端传递 Cookie 到后端

## 实施细节

### 1. 创建 BackendService.swift
- 路径: `dyTool/Services/BackendService.swift`
- 功能:
  - 统一 HTTP 请求封装 (GET/POST)
  - 支持 HTTP 和 HTTPS (使用 curl 作为 HTTP 后备方案)
  - 健康检查接口
  - 用户解析接口 (`/api/users/parse`)
- 响应模型:
  - `UserParseRequest`: 请求体 (url, cookie)
  - `UserParseResponse`: 响应体
  - `ParsedUserProfile`: 用户信息

### 2. 更新 AddUserSheet
- 路径: `dyTool/Views/UserListView.swift`
- 新增功能:
  - 从 DatabaseService 获取 Cookie 并传递给后端
  - URL 输入后按回车或点击刷新按钮自动获取用户信息
  - 剪贴板粘贴 URL 后自动获取
  - 用户信息预览 (头像、昵称、作品数、粉丝数)
  - 自动填充昵称字段
  - 获取状态（loading）和错误/警告提示

### 3. 更新后端 users.py
- 路径: `backend/app/routers/users.py`
- 改进:
  - 检查 Cookie 是否有效（长度 > 100）
  - 即使没有 Cookie 也返回已解析的 sec_user_id
  - 更清晰的错误消息提示
  - 正确处理 f2 的各种错误情况

## 执行结果
- 成功创建 `BackendService.swift`
- 成功更新 `AddUserSheet` 组件
- 成功更新后端 `users.py` 路由
- 用户体验优化: 输入 URL 后可实时预览用户信息

## 依赖
- Python 后端需启动: `cd backend && uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload`
- 需要在设置中配置有效的抖音 Cookie 才能获取完整用户信息

## 注意事项
- f2 库需要有效的 Cookie 才能获取用户详细信息
- 短链接 (v.douyin.com) 可能因过期或反爬虫限制而无法解析，建议使用完整用户主页链接
